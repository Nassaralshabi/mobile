name: Build APK

on:
  push:
    branches: [ main ]
    paths:
      - 'mobile/**'
  workflow_dispatch:
    inputs:
      build_type:
        description: 'Build Type'
        required: true
        default: 'debug'
        type: choice
        options:
          - debug
          - release

jobs:
  build:
    name: Build Flutter APK
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'zulu'
        java-version: '17'

    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.24.0'
        channel: 'stable'
        cache: true

    - name: Get Dependencies
      working-directory: ./mobile
      run: |
        flutter pub get
        flutter doctor -v

    - name: Build Debug APK
      if: ${{ github.event.inputs.build_type == 'debug' || github.event.inputs.build_type == '' }}
      working-directory: ./mobile
      run: flutter build apk --debug

    - name: Build Release APK  
      if: ${{ github.event.inputs.build_type == 'release' }}
      working-directory: ./mobile
      run: flutter build apk --release

    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: marina-hotel-apk
        path: mobile/build/app/outputs/flutter-apk/*.apk
        retention-days: 7

    - name: Build Summary
      run: |
        echo "## ðŸ¨ Marina Hotel APK Build" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Build completed successfully" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ“± APK files are available in artifacts" >> $GITHUB_STEP_SUMMARY